package com.scrat.everchanging;

import android.content.Context;

import com.scrat.everchanging.util.ReusableIterator;

final class Bat extends TextureObject {

    private static final int[][] textureList = {{
            R.drawable.shape_49,
            R.drawable.shape_50,
            R.drawable.shape_51,
            R.drawable.shape_52
    }};
    private static final float[][] texturePivot = {{26.15f, 79.05f}, {46.15f, 59.1f}, {67.15f, 37.2f}, {41.65f, 27.5f}};

    private final byte[] spriteTable = {0, 1, 2, 3, 2, 1};
    private final float[] startMatrix = {1.0000f, 1.0000f, 0.0000f, 0.0000f, -18.25f, 39.5f};

    private final float[][] animateMatrix = {
            {1f, 0.9994f, 0.0000f, 0.0000f, 0f, 0f},
            {1.0000f, 1.0000f, 0.0000f, 0.0000f, 0f, -6f},
            {1.0000f, 1.0000f, 0.0000f, 0.0000f, 0f, -10f},
            {1.0000f, 1.0000f, 0.0000f, 0.0000f, 0f, -15f},
            {1.0000f, 1.0000f, 0.0000f, 0.0000f, 0f, -10.75f},
            {1.0000f, 1.0000f, 0.0000f, 0.0000f, 0f, 0f}
    };

    private final float[][] matrixTransform = {
            {0.0565f, 0.0637f, 0.0000f, 0.0000f, -748.7000f, -282.4000f},
            {0.0571f, 0.0642f, 0.0000f, 0.0000f, -748.1500f, -282.1500f},
            {0.0576f, 0.0646f, 0.0000f, 0.0000f, -747.6000f, -281.9000f},
            {0.0584f, 0.0655f, 0.0000f, 0.0000f, -746.7250f, -281.5250f},
            {0.0593f, 0.0664f, 0.0000f, 0.0000f, -745.8500f, -281.1500f},
            {0.0605f, 0.0676f, 0.0000f, 0.0000f, -744.6000f, -280.6750f},
            {0.0617f, 0.0688f, 0.0000f, 0.0000f, -743.3500f, -280.2000f},
            {0.0633f, 0.0704f, 0.0000f, 0.0000f, -741.7250f, -279.5250f},
            {0.0648f, 0.0719f, 0.0000f, 0.0000f, -740.1000f, -278.8500f},
            {0.0667f, 0.0738f, 0.0000f, 0.0000f, -738.1500f, -278.0500f},
            {0.0686f, 0.0757f, 0.0000f, 0.0000f, -736.2000f, -277.2500f},
            {0.0708f, 0.0779f, 0.0000f, 0.0000f, -733.8500f, -276.2750f},
            {0.0730f, 0.0801f, 0.0000f, 0.0000f, -731.5000f, -275.3000f},
            {0.0756f, 0.0827f, 0.0000f, 0.0000f, -728.8500f, -274.2000f},
            {0.0782f, 0.0853f, 0.0000f, 0.0000f, -726.2000f, -273.1000f},
            {0.0811f, 0.0882f, 0.0000f, 0.0000f, -723.1500f, -271.8750f},
            {0.0841f, 0.0911f, 0.0000f, 0.0000f, -720.1000f, -270.6500f},
            {0.0873f, 0.0944f, 0.0000f, 0.0000f, -716.7000f, -269.2500f},
            {0.0906f, 0.0976f, 0.0000f, 0.0000f, -713.3000f, -267.8500f},
            {0.0942f, 0.1013f, 0.0000f, 0.0000f, -709.5750f, -266.3250f},
            {0.0979f, 0.1049f, 0.0000f, 0.0000f, -705.8500f, -264.8000f},
            {0.1018f, 0.1089f, 0.0000f, 0.0000f, -701.6750f, -263.1000f},
            {0.1058f, 0.1128f, 0.0000f, 0.0000f, -697.5000f, -261.4000f},
            {0.1101f, 0.1171f, 0.0000f, 0.0000f, -693.0500f, -259.5750f},
            {0.1144f, 0.1214f, 0.0000f, 0.0000f, -688.6000f, -257.7500f},
            {0.1190f, 0.1260f, 0.0000f, 0.0000f, -683.7750f, -255.7750f},
            {0.1237f, 0.1306f, 0.0000f, 0.0000f, -678.9500f, -253.8000f},
            {0.1286f, 0.1356f, 0.0000f, 0.0000f, -673.8250f, -251.6750f},
            {0.1336f, 0.1406f, 0.0000f, 0.0000f, -668.7000f, -249.5500f},
            {0.1390f, 0.1459f, 0.0000f, 0.0000f, -663.1000f, -247.2750f},
            {0.1444f, 0.1513f, 0.0000f, 0.0000f, -657.5000f, -245.0000f},
            {0.1500f, 0.1569f, 0.0000f, 0.0000f, -651.5750f, -242.5750f},
            {0.1557f, 0.1626f, 0.0000f, 0.0000f, -645.6500f, -240.1500f},
            {0.1617f, 0.1686f, 0.0000f, 0.0000f, -639.4500f, -237.6250f},
            {0.1677f, 0.1746f, 0.0000f, 0.0000f, -633.2500f, -235.1000f},
            {0.1741f, 0.1810f, 0.0000f, 0.0000f, -626.6250f, -232.3750f},
            {0.1805f, 0.1874f, 0.0000f, 0.0000f, -620.0000f, -229.6500f},
            {0.1872f, 0.1940f, 0.0000f, 0.0000f, -613.0250f, -226.7750f},
            {0.1939f, 0.2007f, 0.0000f, 0.0000f, -606.0500f, -223.9000f},
            {0.2009f, 0.2077f, 0.0000f, 0.0000f, -598.7250f, -220.9000f},
            {0.2080f, 0.2148f, 0.0000f, 0.0000f, -591.4000f, -217.9000f},
            {0.2155f, 0.2222f, 0.0000f, 0.0000f, -583.7250f, -214.7500f},
            {0.2229f, 0.2296f, 0.0000f, 0.0000f, -576.0500f, -211.6000f},
            {0.2307f, 0.2374f, 0.0000f, 0.0000f, -567.9750f, -208.3000f},
            {0.2384f, 0.2451f, 0.0000f, 0.0000f, -559.9000f, -205.0000f},
            {0.2465f, 0.2532f, 0.0000f, 0.0000f, -551.5000f, -201.6000f},
            {0.2545f, 0.2612f, 0.0000f, 0.0000f, -543.1000f, -198.2000f},
            {0.2630f, 0.2697f, 0.0000f, 0.0000f, -534.3500f, -194.5750f},
            {0.2714f, 0.2781f, 0.0000f, 0.0000f, -525.6000f, -190.9500f},
            {0.2802f, 0.2869f, 0.0000f, 0.0000f, -516.4750f, -187.2500f},
            {0.2890f, 0.2956f, 0.0000f, 0.0000f, -507.3500f, -183.5500f},
            {0.2982f, 0.3047f, 0.0000f, 0.0000f, -497.8750f, -179.6500f},
            {0.3073f, 0.3138f, 0.0000f, 0.0000f, -488.4000f, -175.7500f},
            {0.3167f, 0.3232f, 0.0000f, 0.0000f, -478.5750f, -171.7250f},
            {0.3262f, 0.3327f, 0.0000f, 0.0000f, -468.7500f, -167.7000f},
            {0.3360f, 0.3425f, 0.0000f, 0.0000f, -458.5750f, -163.5250f},
            {0.3458f, 0.3523f, 0.0000f, 0.0000f, -448.4000f, -159.3500f},
            {0.3559f, 0.3625f, 0.0000f, 0.0000f, -437.8750f, -155.0250f},
            {0.3661f, 0.3726f, 0.0000f, 0.0000f, -427.3500f, -150.7000f},
            {0.3766f, 0.3831f, 0.0000f, 0.0000f, -416.4000f, -146.2250f},
            {0.3871f, 0.3936f, 0.0000f, 0.0000f, -405.4500f, -141.7500f},
            {0.3979f, 0.4044f, 0.0000f, 0.0000f, -394.1750f, -137.1500f},
            {0.4088f, 0.4152f, 0.0000f, 0.0000f, -382.9000f, -132.5500f},
            {0.4200f, 0.4263f, 0.0000f, 0.0000f, -371.3000f, -127.7750f},
            {0.4312f, 0.4375f, 0.0000f, 0.0000f, -359.7000f, -123.0000f},
            {0.4427f, 0.4491f, 0.0000f, 0.0000f, -347.7250f, -118.1250f},
            {0.4543f, 0.4606f, 0.0000f, 0.0000f, -335.7500f, -113.2500f},
            {0.4661f, 0.4724f, 0.0000f, 0.0000f, -323.4250f, -108.1750f},
            {0.4780f, 0.4843f, 0.0000f, 0.0000f, -311.1000f, -103.1000f},
            {0.4902f, 0.4965f, 0.0000f, 0.0000f, -298.4250f, -97.9250f},
            {0.5025f, 0.5087f, 0.0000f, 0.0000f, -285.7500f, -92.7500f},
            {0.5150f, 0.5213f, 0.0000f, 0.0000f, -272.6750f, -87.3750f},
            {0.5276f, 0.5338f, 0.0000f, 0.0000f, -259.6000f, -82.0000f},
            {0.5405f, 0.5467f, 0.0000f, 0.0000f, -246.1750f, -76.5250f},
            {0.5535f, 0.5596f, 0.0000f, 0.0000f, -232.7500f, -71.0500f},
            {0.5667f, 0.5728f, 0.0000f, 0.0000f, -219.0000f, -65.4250f},
            {0.5800f, 0.5860f, 0.0000f, 0.0000f, -205.2500f, -59.8000f},
            {0.5935f, 0.5996f, 0.0000f, 0.0000f, -191.1500f, -54.0250f},
            {0.6071f, 0.6131f, 0.0000f, 0.0000f, -177.0500f, -48.2500f},
            {0.6211f, 0.6270f, 0.0000f, 0.0000f, -162.5250f, -42.2750f},
            {0.6351f, 0.6410f, 0.0000f, 0.0000f, -148.0000f, -36.3000f},
            {0.6494f, 0.6552f, 0.0000f, 0.0000f, -133.1750f, -30.2750f},
            {0.6636f, 0.6695f, 0.0000f, 0.0000f, -118.3500f, -24.2500f},
            {0.6783f, 0.6841f, 0.0000f, 0.0000f, -103.1750f, -18.0000f},
            {0.6929f, 0.6987f, 0.0000f, 0.0000f, -88.0000f, -11.7500f},
            {0.7079f, 0.7136f, 0.0000f, 0.0000f, -72.4000f, -5.3750f},
            {0.7229f, 0.7286f, 0.0000f, 0.0000f, -56.8000f, 1.0000f},
            {0.7382f, 0.7439f, 0.0000f, 0.0000f, -40.9250f, 7.5000f},
            {0.7535f, 0.7592f, 0.0000f, 0.0000f, -25.0500f, 14.0000f},
            {0.7692f, 0.7749f, 0.0000f, 0.0000f, -8.7750f, 20.6750f},
            {0.7849f, 0.7905f, 0.0000f, 0.0000f, 7.5000f, 27.3500f},
            {0.8009f, 0.8065f, 0.0000f, 0.0000f, 24.1000f, 34.1500f},
            {0.8169f, 0.8225f, 0.0000f, 0.0000f, 40.7000f, 40.9500f},
            {0.8333f, 0.8388f, 0.0000f, 0.0000f, 57.6750f, 47.9000f},
            {0.8496f, 0.8551f, 0.0000f, 0.0000f, 74.6500f, 54.8500f},
            {0.8663f, 0.8718f, 0.0000f, 0.0000f, 92.0250f, 61.9750f},
            {0.8831f, 0.8885f, 0.0000f, 0.0000f, 109.4000f, 69.1000f},
            {0.9001f, 0.9055f, 0.0000f, 0.0000f, 127.1000f, 76.3250f},
            {0.9171f, 0.9225f, 0.0000f, 0.0000f, 144.8000f, 83.5500f},
            {0.9345f, 0.9398f, 0.0000f, 0.0000f, 162.8500f, 90.9500f},
            {0.9519f, 0.9572f, 0.0000f, 0.0000f, 180.9000f, 98.3500f},
            {0.9697f, 0.9749f, 0.0000f, 0.0000f, 199.3250f, 105.9250f},
            {0.9874f, 0.9926f, 0.0000f, 0.0000f, 217.7500f, 113.5000f},
            {1.0057f, 1.0108f, 0.0000f, 0.0000f, 236.5000f, 121.1750f},
            {1.0240f, 1.0290f, 0.0000f, 0.0000f, 255.2500f, 128.8500f},
            {1.0420f, 1.0470f, 0.0000f, 0.0000f, 274.3750f, 136.6750f},
            {1.0600f, 1.0650f, 0.0000f, 0.0000f, 293.5000f, 144.5000f},
            {1.0790f, 1.0840f, 0.0000f, 0.0000f, 313.0250f, 152.4750f},
            {1.0980f, 1.1030f, 0.0000f, 0.0000f, 332.5500f, 160.4500f},
            {1.1170f, 1.1220f, 0.0000f, 0.0000f, 352.3750f, 168.5750f},
            {1.1360f, 1.1410f, 0.0000f, 0.0000f, 372.2000f, 176.7000f},
            {1.1555f, 1.1605f, 0.0000f, 0.0000f, 392.3750f, 184.9750f},
            {1.1750f, 1.1800f, 0.0000f, 0.0000f, 412.5500f, 193.2500f},
            {1.1950f, 1.1995f, 0.0000f, 0.0000f, 433.1000f, 201.6750f},
            {1.2150f, 1.2190f, 0.0000f, 0.0000f, 453.6500f, 210.1000f},
            {1.2350f, 1.2395f, 0.0000f, 0.0000f, 474.6000f, 218.6500f},
            {1.2550f, 1.2600f, 0.0000f, 0.0000f, 495.5500f, 227.2000f},
            {1.2755f, 1.2800f, 0.0000f, 0.0000f, 516.8000f, 235.9250f},
            {1.2960f, 1.3000f, 0.0000f, 0.0000f, 538.0500f, 244.6500f},
            {1.3170f, 1.3210f, 0.0000f, 0.0000f, 559.7000f, 253.5000f},
            {1.3380f, 1.3420f, 0.0000f, 0.0000f, 581.3500f, 262.3500f},
            {1.3590f, 1.3630f, 0.0000f, 0.0000f, 603.3250f, 271.3750f},
            {1.3800f, 1.3840f, 0.0000f, 0.0000f, 625.3000f, 280.4000f},
            {1.4015f, 1.4055f, 0.0000f, 0.0000f, 647.6750f, 289.5500f},
            {1.4230f, 1.4270f, 0.0000f, 0.0000f, 670.0500f, 298.7000f},
            {1.4450f, 1.4490f, 0.0000f, 0.0000f, 692.7000f, 307.9750f},
            {1.4670f, 1.4710f, 0.0000f, 0.0000f, 715.3500f, 317.2500f},
            {1.4890f, 1.4930f, 0.0000f, 0.0000f, 738.4000f, 326.7000f},
            {1.5110f, 1.5150f, 0.0000f, 0.0000f, 761.4500f, 336.1500f},
            {1.5335f, 1.5375f, 0.0000f, 0.0000f, 784.9250f, 345.7750f},
            {1.5560f, 1.5600f, 0.0000f, 0.0000f, 808.4000f, 355.4000f},
            {1.5790f, 1.5830f, 0.0000f, 0.0000f, 832.1500f, 365.1000f},
            {1.6020f, 1.6060f, 0.0000f, 0.0000f, 855.9000f, 374.8000f},
            {1.6255f, 1.6290f, 0.0000f, 0.0000f, 880.0000f, 384.6750f},
            {1.6490f, 1.6520f, 0.0000f, 0.0000f, 904.1000f, 394.5500f},
            {1.6725f, 1.6760f, 0.0000f, 0.0000f, 928.6250f, 404.5750f},
            {1.6960f, 1.7000f, 0.0000f, 0.0000f, 953.1500f, 414.6000f},
            {1.7200f, 1.7235f, 0.0000f, 0.0000f, 977.9750f, 424.8000f},
            {1.7440f, 1.7470f, 0.0000f, 0.0000f, 1002.8000f, 435.0000f},
            {1.7680f, 1.7715f, 0.0000f, 0.0000f, 1028.0500f, 445.3250f},
            {1.7920f, 1.7960f, 0.0000f, 0.0000f, 1053.3000f, 455.6500f},
            {1.8165f, 1.8205f, 0.0000f, 0.0000f, 1078.8750f, 466.1250f},
            {1.8410f, 1.8450f, 0.0000f, 0.0000f, 1104.4500f, 476.6000f},
            {1.8660f, 1.8700f, 0.0000f, 0.0000f, 1130.3500f, 487.2250f},
            {1.8910f, 1.8950f, 0.0000f, 0.0000f, 1156.2500f, 497.8500f},
            {1.9165f, 1.9200f, 0.0000f, 0.0000f, 1182.5750f, 508.6250f},
            {1.9420f, 1.9450f, 0.0000f, 0.0000f, 1208.9000f, 519.4000f},
            {1.9675f, 1.9705f, 0.0000f, 0.0000f, 1235.4751f, 530.3000f},
            {1.9930f, 1.9960f, 0.0000f, 0.0000f, 1262.0500f, 541.2000f},
            {2.0190f, 2.0220f, 0.0000f, 0.0000f, 1289.0500f, 552.2500f},
            {2.0450f, 2.0480f, 0.0000f, 0.0000f, 1316.0500f, 563.3000f},
            {2.0715f, 2.0745f, 0.0000f, 0.0000f, 1343.4250f, 574.5000f},
            {2.0980f, 2.1010f, 0.0000f, 0.0000f, 1370.8000f, 585.7000f},
            {2.1245f, 2.1275f, 0.0000f, 0.0000f, 1398.5000f, 597.0500f},
            {2.1510f, 2.1540f, 0.0000f, 0.0000f, 1426.2000f, 608.4000f},
            {2.1780f, 2.1810f, 0.0000f, 0.0000f, 1454.2250f, 619.8750f},
            {2.2050f, 2.2080f, 0.0000f, 0.0000f, 1482.2500f, 631.3500f},
            {2.2325f, 2.2355f, 0.0000f, 0.0000f, 1510.7250f, 643.0000f},
            {2.2600f, 2.2630f, 0.0000f, 0.0000f, 1539.2000f, 654.6500f},
            {2.2880f, 2.2905f, 0.0000f, 0.0000f, 1567.9750f, 666.4250f},
            {2.3160f, 2.3180f, 0.0000f, 0.0000f, 1596.7500f, 678.2000f},
            {2.3440f, 2.3460f, 0.0000f, 0.0000f, 1625.9000f, 690.1500f},
            {2.3720f, 2.3740f, 0.0000f, 0.0000f, 1655.0500f, 702.1000f},
            {2.4005f, 2.4025f, 0.0000f, 0.0000f, 1684.5000f, 714.1750f},
            {2.4290f, 2.4310f, 0.0000f, 0.0000f, 1713.9500f, 726.2500f},
            {2.4575f, 2.4595f, 0.0000f, 0.0000f, 1743.8000f, 738.4750f},
            {2.4860f, 2.4880f, 0.0000f, 0.0000f, 1773.6500f, 750.7000f},
            {2.5150f, 2.5170f, 0.0000f, 0.0000f, 1803.9000f, 763.1000f},
            {2.5440f, 2.5460f, 0.0000f, 0.0000f, 1834.1500f, 775.5000f},
            {2.5735f, 2.5755f, 0.0000f, 0.0000f, 1864.7000f, 788.0000f},
            {2.6030f, 2.6050f, 0.0000f, 0.0000f, 1895.2500f, 800.5000f},
            {2.6330f, 2.6345f, 0.0000f, 0.0000f, 1926.2000f, 813.1750f},
            {2.6630f, 2.6640f, 0.0000f, 0.0000f, 1957.1500f, 825.8500f},
            {2.6930f, 2.6945f, 0.0000f, 0.0000f, 1988.4500f, 838.6500f},
            {2.7230f, 2.7250f, 0.0000f, 0.0000f, 2019.7500f, 851.4500f},
            {2.7535f, 2.7550f, 0.0000f, 0.0000f, 2051.3501f, 864.4000f},
            {2.7840f, 2.7850f, 0.0000f, 0.0000f, 2082.9500f, 877.3500f},
            {2.8150f, 2.8160f, 0.0000f, 0.0000f, 2114.9500f, 890.4250f},
            {2.8460f, 2.8470f, 0.0000f, 0.0000f, 2146.9500f, 903.5000f},
            {2.8770f, 2.8780f, 0.0000f, 0.0000f, 2179.3501f, 916.8250f},
            {2.9080f, 2.9090f, 0.0000f, 0.0000f, 2211.7500f, 930.1500f},
            {2.9395f, 2.9405f, 0.0000f, 0.0000f, 2244.4250f, 943.5000f},
            {2.9710f, 2.9720f, 0.0000f, 0.0000f, 2277.1001f, 956.8500f},
            {3.0030f, 3.0040f, 0.0000f, 0.0000f, 2310.1250f, 970.4000f},
            {3.0350f, 3.0360f, 0.0000f, 0.0000f, 2343.1499f, 983.9500f},
            {3.0670f, 3.0680f, 0.0000f, 0.0000f, 2376.6499f, 997.6500f},
            {3.0990f, 3.1000f, 0.0000f, 0.0000f, 2410.1499f, 1011.3500f},
            {3.1315f, 3.1325f, 0.0000f, 0.0000f, 2443.8999f, 1025.1750f},
            {3.1640f, 3.1650f, 0.0000f, 0.0000f, 2477.6499f, 1039.0000f},
            {3.1970f, 3.1980f, 0.0000f, 0.0000f, 2511.8250f, 1053.0250f},
            {3.2300f, 3.2310f, 0.0000f, 0.0000f, 2546.0000f, 1067.0500f},
            {3.2630f, 3.2640f, 0.0000f, 0.0000f, 2580.5000f, 1081.1500f},
            {3.2960f, 3.2970f, 0.0000f, 0.0000f, 2615.0000f, 1095.2500f},
            {3.3300f, 3.3305f, 0.0000f, 0.0000f, 2649.8250f, 1109.5000f},
            {3.3640f, 3.3640f, 0.0000f, 0.0000f, 2684.6499f, 1123.7500f},
            {3.3975f, 3.3980f, 0.0000f, 0.0000f, 2719.9248f, 1138.2250f},
            {3.4310f, 3.4320f, 0.0000f, 0.0000f, 2755.2000f, 1152.7000f},
    };

    private static final int MAX_FRAMES = 66;
    private static final int NUM_CLIPS = 7;

    private int frameCounter;

    Bat(final Context context) {
        super(context, textureList, texturePivot);
    }

    void resetObject(final Object object) {
        int _x = random.nextInt(50) + random.nextInt(600) - 300;
        int _y = random.nextInt(25) - 50;
        int _yscale = random.nextInt(10) + 10;
        object.resetViewMatrix();
        object.resetMatrix();
        object.setViewTransform(startMatrix);
        object.setViewScale(_yscale * ratio, _yscale * ratio);
        object.setViewPosition(_x, _y * ratio);
        object.frameCounter = 0;
        object.animCounter = 0;
        object.index = 0;
    }

    void createObject() {
        if (objects.objectsInUseCount() > NUM_CLIPS) return;

        final int textureIndex = textureManager.getTextureIndex(textureList[0][0]);
        final Object object = objects.obtain(textureManager.getTexture(textureIndex), 1.0f);

        final float svgScale = textureManager.dipToPixels(1);
        object.setObjectScale(1.0f / svgScale);

        final int _x = random.nextInt(50) + random.nextInt(600) - 300;
        final int _y = random.nextInt(25) - 50;
        final int _yscale = random.nextInt(15) + 10;

        object.resetViewMatrix();
        object.setViewTransform(startMatrix);
        object.setViewScale(_yscale * ratio, _yscale * ratio);
        object.setViewPosition(_x, _y * ratio);
        object.frameCounter = 0;
        object.animCounter = 0;
        object.index = 0;
    }

    void update(final boolean createObject) {
        frameCounter = (frameCounter + 1) % MAX_FRAMES;
        if (createObject && (frameCounter == 2)) createObject();

        final ReusableIterator<Object> iterator = objects.iterator();
        iterator.acquire();

        while (iterator.hasNext()) {
            final Object object = iterator.next();
            if (object.frameCounter < matrixTransform.length) {
                object.resetMatrix();
                object.setTexture(textureManager.getTexture(textureManager.getTextureIndex(textureList[0][spriteTable[object.animCounter]])), 1.0f);
                object.setTransform(animateMatrix[object.animCounter]);
                object.setTransform(matrixTransform[object.frameCounter]);
                if (object.frameCounter % 2 == 0)
                    object.animCounter = (object.animCounter + 1) % spriteTable.length;
                object.frameCounter++;
            } else {
                if (createObject) resetObject(object);
                else iterator.remove();
            }
        }

        iterator.release();
    }

}
